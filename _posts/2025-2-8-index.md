---
title: Search improvement with index
categories: [Project, Zzikzzik]
tags: [] # TAG names should always be lowercase
---

## âœ… Requirements

- ì¸ë±ìŠ¤ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ ì†ë„ í–¥ìƒì— ë„ì›€ì´ ë¨
- ê²€ìƒ‰í•˜ê³  ì‹¶ì€ ê²ƒì€ ë‘ ì¢…ë¥˜
- user name index
- goal title index

## âœ… ì°¸ê³ ìë£Œ

- DBì¡°íšŒ ìµœì í™” ë°©ë²•, index ì„¤ì • ë°©ë²•, explain ì‚¬ìš© ë°©ë²•
- <https://wanglan.tistory.com/entry/Spring-DB-%EC%A1%B0%ED%9A%8C%EC%9D%98-%EC%B5%9C%EC%A0%81%ED%99%94>

- ì¸ë±ìŠ¤ ì„¤ì • ë°©ë²•, profiling, ngrinder test
- <https://ryusunny.tistory.com/118>

- fulltext search
- <https://velog.io/@ttomy/%EA%B2%80%EC%83%89-fulltext-search%EC%99%80-%EC%8B%A4%ED%97%98>

## âœ… mock data

- ë°ì´í„° ë” ë§Œë“¤ì–´ ë„£ê¸°
- <https://www.mockaroo.com/>
- ë°ì´í„° 10000ê°œ ë„£ìŒ

![Screenshot 2025-02-02 at 09.43.48.png](attachment:210b16db-d1ea-4d23-97cb-67883a808282:Screenshot_2025-02-02_at_09.43.48.png)

## âœ… Jmeter ì„¤ì¹˜

- âœ”ï¸ **Jmeterë€?**
- Apacheì—ì„œ ë§Œë“¤ì—ˆìœ¼ë©° ìˆœìˆ˜í•˜ê²Œ ìë°”ë¡œ ë§Œë“¤ì–´ì§„ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì˜¤í”ˆ ì†ŒìŠ¤ì…ë‹ˆë‹¤.
- GUIë¥¼ ì œê³µí•˜ë©° Logic controllerë¼ê³  ë¶ˆë¦¬ëŠ” ê¸°ëŠ¥ì€ GUIì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ë›°ì–´ë‚œ ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
- ë‹¤ì–‘í•œ í”„ë¡œí† ì½œ/ì„œë²„ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìœ¼ë©° CLIë˜í•œ ì§€ì›í•©ë‹ˆë‹¤.
- ë‹¤ì–‘í•œ ì™¸ë¶€ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ ê¸°ëŠ¥ í™•ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- (ë‚˜ëŠ” ê·¸ë˜í”„ ê·¸ë¦¬ëŠ” í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜í•¨)
- ì—¬ëŸ¬ íŠœí† ë¦¬ì–¼ì„ ë³´ë©´ GUIì„¤ì •ì„ í†µí•´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìœ¼ë©° .jmx íŒŒì¼ì„ í†µí•´ CLIë¡œë„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- âœ”ï¸ **nGrinderë€?**
  ë„¤ì´ë²„ì—ì„œ ì„±ëŠ¥ ì¸¡ì • ëª©ì ìœ¼ë¡œ ê°œë°œ ëœ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.
  Jython, Groovy ë‘ ê°€ì§€ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
  ë˜í•œ Junit ê¸°ë°˜ìœ¼ë¡œ ë˜ì–´ ìˆì–´ IDEì—ì„œ ë¨¼ì € í™•ì¸í•´ë³´ê³  ë””ë²„ê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ ì„¸ë°€í•œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  ê°œë°œìê°€ êµì°© ìƒíƒœì™€ ì†ë„ ì €í•˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.

- Jmeter ì„¤ì¹˜ ë¸”ë¡œê·¸ ì°¸ê³ 
- <https://leeggmin.tistory.com/10>

#### â˜‘ï¸ í† í° ì¶”ê°€í•´ì£¼ì–´ì•¼ í•¨

<img width="1167" alt="Image" src="https://github.com/user-attachments/assets/f992f216-ec28-4ecd-a805-fdd27247ddcb" />

## âœ… SQL profiling on

<img width="400" alt="Image" src="https://github.com/user-attachments/assets/ec6153ce-d506-49bf-925f-96b3fd855c42" />

- profiling on í•˜ê³ 
- size 100ìœ¼ë¡œ ì§€ì •

<img width="462" alt="Image" src="https://github.com/user-attachments/assets/759dff82-c88d-4d95-8806-d82fe150bb4f" />

## 1ï¸âƒ£ ë°ì´í„° 1000ëª…, btree index

#### âŒ Without Index

<img width="828" alt="Image" src="https://github.com/user-attachments/assets/ed000d83-3f4a-4d70-894f-2688f6a79780" />

<img width="674" alt="Image" src="https://github.com/user-attachments/assets/d6fe2d38-c1be-4e37-8916-308d1dace4eb" />

<img width="542" alt="Image" src="https://github.com/user-attachments/assets/fa763aa1-240f-4a65-a1c7-4a1064920cd7" />

<img width="322" alt="Image" src="https://github.com/user-attachments/assets/07e8119f-8f29-4243-b3e3-a805b947d530" />

<img width="358" alt="Image" src="https://github.com/user-attachments/assets/1a440953-5992-4dcd-b6af-31ca11fc89c9" />

#### â˜‘ï¸ btree index ìƒì„±

<img width="367" alt="Image" src="https://github.com/user-attachments/assets/afe55e90-7b69-447c-9029-3f6646664d11" />

- ì¸ë±ìŠ¤ ì„¤ì • ì˜ ëœ ê²ƒ í™•ì¸
  <img width="691" alt="Image" src="https://github.com/user-attachments/assets/378ee694-ebaa-47d5-b0a3-360f31bd01f0" />

#### â­•ï¸ With Index

<img width="212" alt="Image" src="https://github.com/user-attachments/assets/29ab2257-910b-4b85-9fd5-476c73a39dec" />

<img width="367" alt="Image" src="https://github.com/user-attachments/assets/187e6405-4e86-437c-9b49-b48f008abb69" />

#### ğŸ‘ğŸ» Conclusion

- ê²€ìƒ‰ ë°ì´í„° ìˆ˜ê°€ ë„ˆë¬´ ì ì–´ í° ì†ë„ ì°¨ì´ê°€ ì—†ìŒ
- ğŸ’Š ë°ì´í„°ë¥¼ ë” ë§Œë“¤ì–´ ë„£ì

## 2ï¸âƒ£ ë°ì´í„° 10000ëª…, btree index

- ê·¸ëŸ¬ë‚˜ Btree indexë¥¼ ì¶”ê°€í–ˆëŠ”ë° ì™€ì¼ë“œì¹´ë“œ %ì—ëŠ” ë¨¹íˆì§€ ì•ŠìŒ
- ìš°ë¦¬ëŠ” keywordê°€ í¬í•¨ë˜ëŠ” ê²€ìƒ‰ì„ í•˜ê³  ì‹¶ì€ë°,
- the wildcard (`%`) at the beginning of the LIKE pattern prevents MySQL from using a BTREE index

## 3ï¸âƒ£ ë°ì´í„° 10000ëª…, FULLTEXT indexë¥¼ ì“°ê¸°ë¡œ í•¨

- ì´ìœ : ì™€ì¼ë“œì¹´ë“œê°€ ìˆìœ¼ë©´ btree indexì•ˆ ë¨¹í˜
- ğŸ‘ğŸ» Fastest for text searches, optimized for words, can apply index
- ğŸ‘ğŸ» Requires FULLTEXT support (only in `InnoDB` or `MyISAM`)
- luckily mySQL storage engine in Spring boot uses InnoDB

![Screenshot 2025-01-31 at 23.48.21.png](attachment:2d6d1c87-e17a-4e62-9d15-f1e246989eaa:Screenshot_2025-01-31_at_23.48.21.png)

- 1. btree indexë¥¼ ì§€ìš°ê³ 
- ì´ìœ : ê°™ì€ columnì— ë‘ ê°œì˜ ì¸ë±ìŠ¤ ê³µì¡´ ë¶ˆê°€

- 2. Create a FULLTEXT index

```SQL
ALTER TABLE user ADD FULLTEXT INDEX idx_user_name (name);
```

- 3. SQLì¿¼ë¦¬ ì„¤ì •

```SQL
SELECT * FROM user
WHERE MATCH(name) AGAINST('+a*' IN BOOLEAN MODE)
LIMIT 10000;
```

- 4. Springboot JPQLì¿¼ë¦¬ ì„¤ì •
- `MATCH() ... AGAINST()` is **not directly supported by JPA**
- need to use a **native query**
- The `nativeQuery = true` flag tells Spring Data JPA to use **raw SQL** instead of JPQL

```SQL
@Query(value = "SELECT * FROM user WHERE MATCH(name) AGAINST(:keyword IN BOOLEAN MODE) LIMIT 10000", nativeQuery = true)
List<User> searchByFullTextName(@Param("keyword") String keyword);

```

- 4. Fulltext index ì“°ëŠ”ì§€ í™•ì¸ ë°©ë²•

```SQL
EXPLAIN
-- í•˜ê³  SQL ì‹¤í–‰
```

- 5. BOOLEAN MODE ğŸ†š Natural language mode
- Natural language modeëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŒ
- ì´ìœ : **simpler but may not match as aggressively** as `BOOLEAN MODE`
- í•˜ì§€ë§Œ ì¥ì : ì„œë¹„ìŠ¤ì—ì„œ **MySQL to determine relevant matches** without `+keyword*` ì´ëŸ°ê±° ì—†ì–´ë„ ë°”ë¡œ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•¨

#### ğŸ‘ğŸ» Conclusion

- ì´ë ‡ê²Œ ëŒë ¸ë”ë‹ˆ ì›ë˜ ì¿¼ë¦¬ë‘ ê²€ìƒ‰ê°’ì´ ë‹¤ë¦„!

```SQL
SELECT * FROM user
WHERE name LIKE '%a%'
LIMIT 0, 10000;
```

```SQL
SELECT * FROM user
WHERE MATCH(name) AGAINST('+a*' IN BOOLEAN MODE)
LIMIT 10000;
```

- ğŸ‘ğŸ» FULLTEXT indexì„¤ì • í›„ ì¿¼ë¦¬ë¥¼ ëŒë ¸ë”ë‹ˆ ì›ë˜ ì¿¼ë¦¬ì™€ ê²€ìƒ‰ê°’ì´ ë‹¤ë¦„

![Screenshot 2025-02-01 at 00.41.31.png](attachment:a3c42f15-1d48-4fba-a66c-693f67ffb994:Screenshot_2025-02-01_at_00.41.31.png)

- ì´ìœ 
  <https://velog.io/@ttomy/%EA%B2%80%EC%83%89-fulltext-search%EC%99%80-%EC%8B%A4%ED%97%98>

```
Full-text indexëŠ” MySQLì—ì„œ ì—ì„œ FULLTEXT íƒ€ì…ì˜ ì¸ë±ìŠ¤ì´ë‹¤.
ê·¸ëŸ°ë° ì›ë˜ built-inëœ ê¸°ë³¸ text parserëŠ” ê³µë°± ë‹¨ìœ„ë¡œ ë˜ì–´ìˆê¸°ì—
ì–´ì ˆì— ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ì¡°íšŒí•´ì˜¨ë‹¤.

ë¶€ë¶„ ë¬¸ìì—´(part-of-word) ê²€ìƒ‰ì´ ì•ˆëœë‹¤ëŠ” ê²ƒì¸ë°, ì˜ˆë¥¼ ë“¤ë©´
mysql fulltext indexë¼ëŠ” ë°ì´í„°ê°€ ìˆê³  'my', 'full'ë¼ëŠ” ê²€ìƒ‰ì–´ë¡œ ì¡°íšŒí•´ë„ í•œ ì–´ì ˆê³¼ ì™„ì „íˆ ì¼ì¹˜í•˜ì§€ëŠ” ì•Šê¸°ì— ê²€ìƒ‰ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.

ì´ë¥¼ ê¸€ì ë‹¨ìœ„ë¡œ ê²€ìƒ‰ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´ n-gram parserë¥¼ ì§€ì›í•œë‹¤.
ë‹¤ë§Œ ë” ì‘ì€ ë‹¨ìœ„ë¡œ textì˜ ì¸ë±ìŠ¤ë“¤ì„ ë§ì´ ìƒì„±í•˜ê¸°ì— ë” ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì¸ì§€í•´ì•¼í•œë‹¤.
ì•„ì£¼ ë§ì€ textì— ëŒ€í•´ n-gram parserì˜ tokenì‚¬ì´ì¦ˆë¥¼ ì‘ê²Œ ì¡ìœ¼ë©´ dbì—ì„œë„ ì¸ë±ìŠ¤ ì‚¬ìš© ì‹œ ë””ìŠ¤í¬ì— ì ‘ê·¼í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì ¸ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆë‹¤.
```

- ğŸ’Š n-gram parserì„ ì ìš©

## 4ï¸âƒ£ ë°ì´í„° 10000ëª…, FULLTEXT index, n-gram

#### â­•ï¸ With Index

![Screenshot 2025-02-01 at 00.44.04.png](attachment:feb57e86-364a-49b1-8247-a07946a33d4a:Screenshot_2025-02-01_at_00.44.04.png)

- n-gram token size: 2
  ![Screenshot 2025-02-01 at 00.44.25.png](attachment:ccc1d31a-7df0-4250-a7b9-98221aabb3b9:Screenshot_2025-02-01_at_00.44.25.png)

- ğŸ‘ğŸ» ë¬¸ì œ 1: ngram token ì‚¬ì´ì¦ˆê°€ 2ë¼ì„œ ê²€ìƒ‰ì–´ê°€ 2ê¸€ì ì´ìƒì´ì–´ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ìƒê¹€
- í•œ ê¸€ìëŠ” ê²€ìƒ‰ì´ ë¶ˆê°€

![image.png](attachment:ca031bab-e9a6-46b3-979c-48a3a2a4283c:image.png)

- ğŸ‘ğŸ» ë¬¸ì œ 2: ì´ë¦„ Beniaminoë¥¼ ê²€ìƒ‰í–ˆë”ë‹ˆ 203ê°œì˜ ê²°ê³¼ê°€ ë‚˜ì˜´
- ì •ì‘ BeniaminoëŠ” DBì— í•œ ëª…ë°–ì— ì—†ëŠ”ë°
- â“ ì™œ ê·¸ëŸ°ì§€ ì´ìœ ë¥¼ íŒŒì•…í•´ë³´ë‹ˆ
  - 1. í˜„ì¬ ngramì„ ì“°ê³  ìˆìŒ
  - 2. **splits words into smaller pieces** (tokens) based on `ngram_token_size`
  - 3. í˜„ì¬ í† í° ì‚¬ì´ì¦ˆ = 2
  - ğŸ‘ğŸ» ê²°ë¡ : 2ê¸€ìì”© ìª¼ê°œì„œ ê²€ìƒ‰ ì¤‘
  ```
  Be, en, ni, ia, am, mi, in, no
  ```
- MySQL doesnâ€™t search for exactly "Beniamino". Instead, it searches for any name that contains these tokens, which is why you get extra results.

#### â˜‘ï¸ ngram token ì‚¬ì´ì¦ˆ ë³€ê²½

![Screenshot 2025-02-01 at 00.54.18.png](attachment:e6df91d9-4b05-43af-b7a4-6e62f23efc2b:Screenshot_2025-02-01_at_00.54.18.png)

- `sudo vi /etc/my.cnf` í¸ì§‘í•¨
  ![Screenshot 2025-02-01 at 00.58.09.png](attachment:a1a81390-7ec4-42d4-966d-14a8c87d36c3:Screenshot_2025-02-01_at_00.58.09.png)

- ë³€ê²½ì™„ë£Œ
  ![Screenshot 2025-02-01 at 00.59.29.png](attachment:f3bc7152-9ced-4576-8288-e5104bcd9e12:Screenshot_2025-02-01_at_00.59.29.png)

- í•˜ê³  ë‚˜ì„œ ì¸ë±ìŠ¤ ì§€ìš°ê³  ë‹¤ì‹œ ë§Œë“¤ì–´ ì¤˜ì•¼ í•¨

#### ğŸ‘ğŸ» Conclusion

- n-gramë„ ì„¤ì •í•˜ê³ 
- n-gram tokenì‚¬ì´ì¦ˆë¡œ 1ë¡œ ë³€ê²½í•˜ì—¬ í•œ ê¸€ì ì•ŒíŒŒë²³ ê²€ìƒ‰ë„ ê°€ëŠ¥í•˜ê²Œ í–ˆìœ¼ë‚˜
- ê²€ìƒ‰ ì†ë„ê°€ ë” ëŠë ¤ì§

- â“ ì´ìœ : The ngram parser splits words into smaller pieces, which increases index size and slows down searches.
- í•˜ì§€ë§Œ ngramì„ ì•ˆ ì“¸ìˆ˜ëŠ” ì—†ìŒ. ì•ˆ ì“°ë©´ LIKEë¡œ í–ˆì„ë•Œë‘ ê²°ê³¼ ê°’ ê°¯ìˆ˜ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤
- í•œë§ˆë””ë¡œ, ngramì„ ì•ˆ ì“°ë©´ `A` ë¡œ ì‹œì‘í•˜ëŠ” ì´ë¦„ë§Œ ê²€ìƒ‰, ë˜ëŠ” ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ê²€ìƒ‰
- ê·¸ë˜ì„œ ngramì„ ì“°ë©´ tokenì‚¬ì´ì¦ˆì— ë”°ë¼ ê²€ìƒ‰ ë°©ë²•ì´ ë°”ë€ŒëŠ”ë°
- í•œ ê¸€ì ê²€ìƒ‰ë„ ê°€ëŠ¥í•˜ë„ë¡ tokenì‚¬ì´ì¦ˆë¥¼ 1ë¡œ í•˜ë©´ ê²€ìƒ‰ ì†ë„ê°€ ë” ëŠë ¤ì§„ë‹¤

- ê·¸ë˜ì„œ í•œ ê¸€ì ê²€ìƒ‰ì„ í¬ê¸°í•˜ê³ , tokenì‚¬ì´ì¦ˆë¥¼ ë” í‚¤ì›Œì„œ 2ë¡œ í•˜ë”ë¼ë„ ê¸€ì”¨ë¥¼ ìª¼ê°œì„œ ê²€ìƒ‰í•˜ë‹¤ë³´ë‹ˆ ê²€ìƒ‰ ê²°ê³¼ê°€ ì˜ˆìƒê³¼ ë‹¤ë¥´ë‹¤ëŠ” ë¬¸ì œê°€ ë°œìƒí•¨

## âœ… ìœ ì €ëŠ” btree indexë¡œ ê²€ìƒ‰í•˜ê¸°ë¡œ ê²°ì •

- ê·¸ë¦¬ê³  ëª©í‘œëŠ” fulltext indexë¡œ ê²€ìƒ‰í•˜ê¸°ë¡œ ê²°ì •

```
ìœ ì € ì´ë¦„ ê²€ìƒ‰,
keywordë¡œ ì‹œì‘í•˜ëŠ” ìœ ì € ê²€ìƒ‰í•˜ê¸°ë¡œ
btree index

ëª©í‘œëŠ” ëª©í‘œ ì œëª© ê²€ìƒ‰
keywordë¥¼ í¬í•¨í•˜ëŠ” ëª©í‘œ ê²€ìƒ‰í•˜ê¸°ë¡œ
fulltext index
```

- ìœ ì €ì´ë¦„ ê²€ìƒ‰ì„ keywordë¥¼ í¬í•¨í•˜ëŠ” ê²€ìƒ‰ì„ í•˜ê³  ì‹¶ì–´ì„œ
- btree indexë¡œ êµ¬í˜„í•˜ì˜€ìœ¼ë‚˜, %ì´ ë“¤ì–´ê°€ë©´ btree indexë¶ˆê°€
- ê·¸ë˜ì„œ fulltext indexë¡œ êµ¬í˜„í•˜ë ¤ê³  í–ˆìœ¼ë‚˜
- fulltext indexëŠ” ngram í† í° ì‚¬ì´ì¦ˆë¡œ ê²€ìƒ‰ì–´ë¥¼ ìª¼ê°œì„œ ê²€ìƒ‰, ê²€ìƒ‰ ê²°ê³¼ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦„
- ê·¸ë¦¬ê³  ìœ ì € ì´ë¦„ì˜ ì¼ë¶€ë¥¼ ê²€ìƒ‰í•˜ëŠ” ì¼ì€ ì—†ì„ ê²ƒì´ë¼ íŒë‹¨
- ë”°ë¼ì„œ ìœ ì € ê²€ìƒ‰ì€ keywordë¡œ ì‹œì‘í•˜ëŠ” ìœ ì € ì´ë¦„ì„ btree indexë¥¼ í™œìš©í•´ ê²€ìƒ‰í•˜ê¸°ë¡œ ê²°ì •

- ë°˜ëŒ€ë¡œ ëª©í‘œëŠ” keywordë¥¼ í¬í•¨í•´ì„œ ì°¾ëŠ” ê²½ìš°ê°€ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨
- fulltext indexë¡œ êµ¬í˜„í•˜ê¸°ë¡œ ê²°ì •

## BTREE ğŸ†š FULLTEXT

- FULLTEXT

```SQL
ALTER TABLE user ADD FULLTEXT INDEX idx_user_name (name);

SELECT * FROM user
WHERE MATCH(name) AGAINST('a*' IN BOOLEAN MODE)
LIMIT 10000;
```

- BTREE

```SQL
CREATE INDEX idx_user_name ON user(name);

SELECT * FROM user
WHERE name LIKE 'a%'
LIMIT 10000;
```

```
List<User> findByNameStartingWith(String keyword);
```

```
entity
@Table(name= "user", indexes= @Index(name="idx_user_name", columnList = "user"))
```

## âœ… User name BTREE Index

- keywordë¡œ ì‹œì‘í•˜ëŠ” ìœ ì € ê²€ìƒ‰

#### â˜‘ï¸ SQL commands

```SQL
SELECT * FROM zzikzzik.user LIMIT 1000, 1020
SELECT count(*) FROM user;
```

- set profiling

```SQL
SET profiling=1;
SET profiling_history_size=100;
show variables like '%profiling%';
```

- CREATE INDEX

```SQL
USE zzikzzik;
-- btree index
CREATE INDEX idx_user_name ON user(name);
-- index ì—†ì• ê¸°
DROP INDEX idx_user_name ON user;
-- fulltext index
ALTER TABLE user ADD FULLTEXT INDEX idx_user_name (name);
-- fulltext index with ngram
ALTER TABLE user ADD FULLTEXT INDEX idx_user_name (name) with parser ngram;
show index from user;
```

- BTREE INDEX query

```SQL
USE zzikzzik;
-- EXPLAIN
SELECT * FROM user
WHERE name LIKE 'Beniamino%'
LIMIT 0, 10000;
-- show profiles;
-- show profile for query 33;
-- show profile cpu for query 33;
```

- FULL TEXT INDEX query

```SQL
USE zzikzzik;
-- EXPLAIN
SELECT * FROM user
WHERE MATCH(name) AGAINST('e' IN BOOLEAN MODE)
LIMIT 10000;

SELECT * FROM user
WHERE MATCH(name) AGAINST('Beniamino' IN NATURAL LANGUAGE MODE)
LIMIT 10000;
-- show profiles;
-- show profile for query 22;
-- show profile cpu for query 22;
```

- SHOW VARIABLES

```SQL
SHOW TABLE STATUS WHERE Name = 'user';
show global variables like 'ngram_token_size';
SHOW VARIABLES LIKE 'ft_min_word_len';
SHOW VARIABLES LIKE 'ft_stopword_file';
```

#### â˜‘ï¸ Spring

- âœ”ï¸ **ì¸ë±ìŠ¤ ì „**

```JAVA
repository
List<User> findByNameContains(@Param("keyword") String keyword);

```

```JAVA
serviceImpl
if( searchField.equals(SearchField.USER_NAME.getValue()) ){
           List<User> searchedUsers = userRepository.findByNameContains(keyword);
```

- âœ”ï¸ **BTREE ì¸ë±ìŠ¤ í›„**

```JAVA
repository
List<User> findByNameStartingWith(@Param("keyword") String keyword);
```

```JAVA
serviceImpl
if( searchField.equals(SearchField.USER_NAME.getValue()) ){
     List<User> searchedUsers = userRepository.findByNameStartingWith(keyword);
```

```JAVA
user entity
@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Table(name= "user", indexes= @Index(name="idx_user_name", columnList = "user"))
public class User {

}
```

- âœ”ï¸ **FULLTEXT ì¸ë±ìŠ¤ í›„**

```JAVA
repository
@Query(value = "SELECT * FROM user WHERE MATCH(name) AGAINST(:keyword IN BOOLEAN MODE) LIMIT 10000", nativeQuery = true)
List<User> searchByFullTextName(@Param("keyword") String keyword);
```

```JAVA
serviceImpl
if( searchField.equals(SearchField.USER_NAME.getValue()) ){
     List<User> searchedUsers = userRepository.searchByFullTextName(keyword);
```

```JAVA
user entity
@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Table(name= "user", indexes= @Index(name="idx_user_name", columnList = "user"))
public class User {
```

#### âŒ Without Index

- âœ”ï¸ **ì¸ë±ìŠ¤ ì—†ìŒ í™•ì¸**
  ![Screenshot 2025-02-01 at 18.32.57.png](attachment:b8e588ef-974f-46d2-babc-04222400adfe:Screenshot_2025-02-01_at_18.32.57.png)

- âœ”ï¸ **mySQL explain**
- ì¸ë±ìŠ¤ ì•ˆì“°ê³  ìˆìŒ í™•ì¸

![Screenshot 2025-02-01 at 18.34.01.png](attachment:f1c16998-68e4-425d-893b-011afd0b8101:Screenshot_2025-02-01_at_18.34.01.png)

- âœ”ï¸ **MySQLì—ì„œ ê·¸ëƒ¥ ì¿¼ë¦¬ ëŒë ¤ë³´ê¸°, ì‹œê°„ í™•ì¸**
  ![Screenshot 2025-02-01 at 18.33.45.png](attachment:fcf959d8-e4ef-4716-8a14-f6e12adc3d27:Screenshot_2025-02-01_at_18.33.45.png)

  - â¡ï¸ aë¡œ ì‹œì‘í•˜ëŠ” ìœ ì € ê²€ìƒ‰: 0.755/0.820ì´ˆ
    ![Screenshot 2025-02-01 at 18.35.07.png](attachment:4c9287f1-f22e-46bf-b35d-498ae65b2544:Screenshot_2025-02-01_at_18.35.07.png)
  - â¡ï¸ íŠ¹ì • ì´ë¦„ ê²€ìƒ‰: 0.405ì´ˆ

- âœ”ï¸ **MySQL show profile**
  ![Screenshot 2025-02-01 at 18.36.20.png](attachment:1c383425-382b-43c2-9af5-425c6420cba2:Screenshot_2025-02-01_at_18.36.20.png)

- âœ”ï¸ **MySQL show CPU profile**
  ![Screenshot 2025-02-01 at 18.36.38.png](attachment:6e320027-25e5-4584-9d20-ef344af0622c:Screenshot_2025-02-01_at_18.36.38.png)

  - â¡ï¸ 0.000073ì´ˆ

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 200ê°œ**

![Screenshot 2025-02-01 at 18.42.41.png](attachment:060c953f-3199-4603-8f00-f24d5448dd48:Screenshot_2025-02-01_at_18.42.41.png)

![Screenshot 2025-02-01 at 18.42.52.png](attachment:cc0866a3-14d6-4739-87f7-c67841b5f64e:Screenshot_2025-02-01_at_18.42.52.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000ê°œ**

![Screenshot 2025-02-01 at 19.51.23.png](attachment:4fc76ae7-0ba9-4ac3-8bfd-cda244b4af54:Screenshot_2025-02-01_at_19.51.23.png)

![Screenshot 2025-02-01 at 19.51.36.png](attachment:a504156a-a028-4289-8bb3-c6bd6b164566:Screenshot_2025-02-01_at_19.51.36.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000ê°œ íŠ¹ì • ìœ ì € ê²€ìƒ‰**

![Screenshot 2025-02-02 at 10.39.11.png](attachment:5fe39e4f-455b-472a-b1aa-d7fc0e90d832:Screenshot_2025-02-02_at_10.39.11.png)

![Screenshot 2025-02-02 at 10.38.36.png](attachment:6a5fe8fb-2396-4898-a340-1e112449a328:Screenshot_2025-02-02_at_10.38.36.png)

- âœ”ï¸ **Postman test**
  ![Screenshot 2025-02-01 at 18.41.57.png](attachment:673f270a-278e-4804-bfbd-fefd4d414276:Screenshot_2025-02-01_at_18.41.57.png)

  - â¡ï¸ 4.88ì´ˆ

![Screenshot 2025-02-01 at 19.13.40.png](attachment:f61cfbbd-8bf9-4c11-97e5-f9604209beb7:Screenshot_2025-02-01_at_19.13.40.png)

- âœ”ï¸ **Postman test íŠ¹ì • ìœ ì € ê²€ìƒ‰**
  ![Screenshot 2025-02-02 at 10.20.29.png](attachment:15290609-a44c-4c42-ab85-4b398921965d:Screenshot_2025-02-02_at_10.20.29.png)

  - â¡ï¸ 3.66ì´ˆ

#### â­•ï¸ With Index

- âœ”ï¸ **Btree index ì„¤ì • í™•ì¸**

![Screenshot 2025-02-01 at 18.44.26.png](attachment:df5c5a45-65d4-4caf-b8f8-2d94c57094cc:Screenshot_2025-02-01_at_18.44.26.png)

- âœ”ï¸ **mySQL explain**
- ì¸ë±ìŠ¤ ì‚¬ìš©í•˜ëŠ” ê²ƒ í™•ì¸
  ![Screenshot 2025-02-01 at 18.46.10.png](attachment:f7c4bba9-a234-41e5-83ed-13ac1ee66800:Screenshot_2025-02-01_at_18.46.10.png)

- âœ”ï¸ **MySQLì—ì„œ ê·¸ëƒ¥ ì¿¼ë¦¬ ëŒë ¤ë³´ê¸°, ì‹œê°„ í™•ì¸**
  ![Screenshot 2025-02-01 at 18.47.42.png](attachment:e7813501-8091-444b-a92d-a9ae007657c4:Screenshot_2025-02-01_at_18.47.42.png)

  - â¡ï¸ aê²€ìƒ‰: 0.666ì´ˆ

![Screenshot 2025-02-01 at 18.48.55.png](attachment:1572a2d3-4532-47bf-9abb-f98cb38fdf20:Screenshot_2025-02-01_at_18.48.55.png)

- â¡ï¸ íŠ¹ì • ì´ë¦„ ê²€ìƒ‰: 0.371ì´ˆ

- âœ”ï¸ **MySQL show profile**

![Screenshot 2025-02-01 at 18.49.53.png](attachment:43dd08e4-cffb-4d6e-9312-f1dd2404a722:Screenshot_2025-02-01_at_18.49.53.png)

- âœ”ï¸ **MySQL show CPU profile**
  ![Screenshot 2025-02-01 at 18.50.35.png](attachment:12c5826d-ccd5-4489-9386-6a140ea263fe:Screenshot_2025-02-01_at_18.50.35.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 200ê°œ**
  ![Screenshot 2025-02-01 at 19.00.29.png](attachment:5fe71690-0ab8-4cb3-b215-31e70362cea5:Screenshot_2025-02-01_at_19.00.29.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000ê°œ**

![Screenshot 2025-02-01 at 20.30.54.png](attachment:aa93e998-289f-4ab5-9140-538a476dd0eb:Screenshot_2025-02-01_at_20.30.54.png)

![Screenshot 2025-02-01 at 20.31.10.png](attachment:0eb07e00-cb03-48cd-958c-fb8895c05cbd:Screenshot_2025-02-01_at_20.31.10.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000ê°œ íŠ¹ì • ìœ ì € ê²€ìƒ‰**

![Screenshot 2025-02-02 at 10.59.36.png](attachment:b71d92be-c5be-405f-a6c2-eebf3545a676:Screenshot_2025-02-02_at_10.59.36.png)

![Screenshot 2025-02-02 at 11.05.02.png](attachment:1f6938e2-f3f3-4006-9071-d323316a5bca:Screenshot_2025-02-02_at_11.05.02.png)

- âœ”ï¸ **Postman test**

![Screenshot 2025-02-01 at 18.58.59.png](attachment:b31117f3-1a24-4f7c-a285-007d60c1a65a:Screenshot_2025-02-01_at_18.58.59.png)

![Screenshot 2025-02-01 at 19.52.51.png](attachment:d17ca84c-16d6-4e92-8cbd-ae4a7e86e4c2:Screenshot_2025-02-01_at_19.52.51.png)

- â¡ï¸ 3.69ì´ˆ

- âœ”ï¸ **Postman test íŠ¹ì • ìœ ì € ê²€ìƒ‰**

![Screenshot 2025-02-02 at 10.40.56.png](attachment:d294a8a9-e2ba-4d33-bd08-e159cea12c82:Screenshot_2025-02-02_at_10.40.56.png)

#### ğŸ‘ğŸ» Improvements

1. indexì„¤ì •ìœ¼ë¡œ search rows 9854 â†’ 865 <br>
2. íŠ¹ì • ì•ŒíŒŒë²³ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ìœ ì € ì°¾ê¸° jmeter 1ë§Œ ë°ì´í„° sample 200ê±´ throughput 3.3/sec â†’ 4.0/sec <br>
3. jmeter 1ë§Œ ë°ì´í„° sample 1ë§Œê±´ì— ëŒ€í•œ throughput 4.5 â†’ 4.6/sec <br>
4. ê°™ì€ ìœ ì €ë¥¼ ì°¾ëŠ” ì¿¼ë¦¬ëŠ” ì²˜ë¦¬ëŸ‰ì—ì„œëŠ” í° ì°¨ì´ê°€ ë‚˜ì§€ ì•Šì•˜ìœ¼ë‚˜, ì‘ë‹µ ì‹œê°„ê³¼ í‘œì¤€í¸ì°¨ì—ì„œ ê°œì„  <br>
5. ì—ëŸ¬ 0 <br>

#### â“ ì´ë ‡ê²Œ ê°œë°œí•œ ì´ìœ 

- BTREE indexì‚¬ìš©
  - ì´ìœ : ìœ ì € ì´ë¦„ì€ íŠ¹ì • í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•˜ëŠ” ê²½ìš°ê°€ ë§ê³ , í¬í•¨í•´ì„œ ê²€ìƒ‰í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  íŒë‹¨
- boolean modeë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤
  - ì´ìœ : ë‹¤ì–‘í•œ ê²€ìƒ‰ ì¡°ê±´ì„ ì¤„ ìˆ˜ ìˆë‹¤(íŠ¹ì • ë‹¨ì–´ í¬í•¨, ì–´ë–¤ ë‹¨ì–´ëŠ” í¬í•¨í•˜ì§€ ì•Šì„ ê²ƒ)

## âœ… Goal title FULLTEXT Index

keyword í¬í•¨í•˜ëŠ” ëª©í‘œ ê²€ìƒ‰

#### âŒ Without Index

- âœ”ï¸ **ì¸ë±ìŠ¤ ì—†ëŠ” ê²ƒ í™•ì¸**
- Goal Index ì„¤ì • ì „
- goal titleì— ëŒ€í•´ì„œ ì¸ë±ìŠ¤ ì—†ëŠ” ê²ƒ í™•ì¸
  ![Screenshot 2025-02-02 at 12.48.27.png](attachment:45e01dc5-82f8-434c-96c3-939a219e32c6:Screenshot_2025-02-02_at_12.48.27.png)

- âœ”ï¸ **mySQL explain**
- ì¸ë±ìŠ¤ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒ í™•ì¸

![Screenshot 2025-02-02 at 12.45.04.png](attachment:848dbf6f-ca16-4222-828d-21b1ebdb697e:Screenshot_2025-02-02_at_12.45.04.png)

- âœ”ï¸ **MySQLì—ì„œ ê·¸ëƒ¥ ì¿¼ë¦¬ ëŒë ¤ë³´ê¸°, ì‹œê°„ í™•ì¸**
  ![Screenshot 2025-02-02 at 12.49.25.png](attachment:80195620-876c-484c-8df0-662472bd0dee:Screenshot_2025-02-02_at_12.49.25.png)

![Screenshot 2025-02-02 at 12.44.46.png](attachment:ffedef19-a0b8-47d8-8b4a-f47f6e07e638:Screenshot_2025-02-02_at_12.44.46.png)

- âœ”ï¸ **MySQL show profile**
  ![Screenshot 2025-02-02 at 12.46.31.png](attachment:6ddeb7f6-e07c-4428-bfa1-f2aca42d8c40:Screenshot_2025-02-02_at_12.46.31.png)

- âœ”ï¸ **MySQL show CPU profile**
  ![Screenshot 2025-02-02 at 12.46.48.png](attachment:e7268892-1f4c-4f64-b4b8-8c4113cde50c:Screenshot_2025-02-02_at_12.46.48.png)

  - â¡ï¸ 204

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 200**

![image.png](attachment:b18b24a3-21d0-43e1-9a68-9a7178c2ce01:image.png)

- â¡ï¸ 4.9/sec

- ë” ë†’ê²Œ ë‚˜ì˜¨ ê²½ìš°

![Screenshot 2025-02-02 at 12.55.31.png](attachment:7cc6adb1-94a8-4740-9a2e-afc8dab6e778:Screenshot_2025-02-02_at_12.55.31.png)

![Screenshot 2025-02-02 at 12.54.23.png](attachment:85848bea-b8ba-4068-9c11-d42ca416f6f1:Screenshot_2025-02-02_at_12.54.23.png)

![Screenshot 2025-02-02 at 12.55.56.png](attachment:b47e6bf2-fc51-46f2-bd26-54717b67111e:Screenshot_2025-02-02_at_12.55.56.png)

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000**

![Screenshot 2025-02-02 at 13.34.14.png](attachment:e45df517-ff6e-4455-a3ce-7dd86c49bee2:Screenshot_2025-02-02_at_13.34.14.png)

![Screenshot 2025-02-02 at 13.34.34.png](attachment:9910d5ac-a978-4e3d-a6c4-882c8c9df09a:Screenshot_2025-02-02_at_13.34.34.png)

- âœ”ï¸ **Postman test**
  ![Screenshot 2025-02-02 at 12.51.19.png](attachment:2b0c1920-6578-4f54-8884-53a1f826bd43:Screenshot_2025-02-02_at_12.51.19.png)

  - â¡ï¸ 2.97ì´ˆ 8.87KB

#### â­•ï¸ With Index

- âœ”ï¸ **mySQLì— ì¸ë±ìŠ¤ ë§Œë“¤ê³  ì˜ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸**

![Screenshot 2025-02-02 at 13.35.06.png](attachment:ed8f6587-6cc6-41ac-b37e-b03cce4d186a:Screenshot_2025-02-02_at_13.35.06.png)

- âœ”ï¸ **ngram_token_sizeë¥¼ 2ë¡œ í–ˆì„ ë•Œ**

![Screenshot 2025-02-02 at 14.12.29.png](attachment:50b6b2e6-c46e-4eb3-bacb-4be2803e8b93:Screenshot_2025-02-02_at_14.12.29.png)

- âœ”ï¸ **mySQL explain**
- ì¸ë±ìŠ¤ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒ í™•ì¸

![Screenshot 2025-02-02 at 13.38.21.png](attachment:b760928b-4826-4239-a04e-ac1b08223bc7:Screenshot_2025-02-02_at_13.38.21.png)

- âœ”ï¸ **MySQLì—ì„œ ê·¸ëƒ¥ ì¿¼ë¦¬ ëŒë ¤ë³´ê¸°, ì‹œê°„ í™•ì¸**

![Screenshot 2025-02-02 at 13.38.05.png](attachment:97998824-b430-4701-ac41-cb1b840d2ed0:Screenshot_2025-02-02_at_13.38.05.png)

- â¡ï¸ 301ì´ˆ

- âœ”ï¸ **MySQL show profile**

![Screenshot 2025-02-02 at 13.39.40.png](attachment:d84309f3-49a9-4328-8092-7cd52a9de314:Screenshot_2025-02-02_at_13.39.40.png)

- âœ”ï¸ **MySQL show CPU profile**

![Screenshot 2025-02-02 at 13.39.55.png](attachment:38eaf8b0-a52a-446f-bc5a-7631e578817e:Screenshot_2025-02-02_at_13.39.55.png)

- â¡ï¸ 43

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 200**

![Screenshot 2025-02-02 at 23.31.03.png](attachment:887001d1-fc18-4ccb-b0c2-74c899f6c0ac:Screenshot_2025-02-02_at_23.31.03.png)

- â¡ï¸ 200ê°œ 5.6

- âœ”ï¸ **Jmeter test ìƒ˜í”Œ 10000**

![Screenshot 2025-02-02 at 22.23.01.png](attachment:01131473-82c8-4e6c-8219-2623f20ffb71:Screenshot_2025-02-02_at_22.23.01.png)

- âœ”ï¸ **Postman test**

![Screenshot 2025-02-02 at 14.13.29.png](attachment:8405df2e-2ed4-4f38-951d-cd56e29f7c42:Screenshot_2025-02-02_at_14.13.29.png)

#### ğŸ‘ğŸ» Improvements

1. search rows 9961 â†’ 1 <br>
2. jmeter 1ë§Œ ë°ì´í„° sample 200ê±´ í‘œì¤€í¸ì°¨ ê°ì†Œ ë° throughput 4.9/sec â†’ 5.6/sec <br>
3. í•˜ì§€ë§Œ í¬ê²Œ ê°œì„ í•œ ì ì€ ì—†ëŠ” ê²ƒ ê°™ì€ê²Œ, ngram tokenì´ 2ë¼ì„œ ê·¸ëŸ° ê²ƒ ê°™ê¸°ë„ í•¨ <br>

#### â“ ì´ë ‡ê²Œ ê°œë°œí•œ ì´ìœ 

- FULLTEXT Index
  - ì´ìœ : ëª©í‘œëŠ” ë‹¨ì–´ë¥¼ í¬í•¨í•´ì„œ ê²€ìƒ‰í•´ì•¼ í•œë‹¤(ì˜ˆë¥¼ ë“¤ì–´ toeicì´ë©´ `ì´ë²ˆ ë‹¬ toeic 700ì  ëª©í‘œ`ë“± ì°¾ì•„ì•¼ í•¨)
  - ë”°ë¼ì„œ ì™€ì¼ë“œì¹´ë“œ `%`ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
  - ê·¸ëŸ°ë° BTREE indexëŠ” ì™€ì¼ë“œì¹´ë“œ ë¶ˆê°€
- ngram size token=2
  - ì´ìœ : ì–´ì ˆì— ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” ê²ƒë§Œ ì¡°íšŒí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë¶€ë¶„ ë¬¸ìì—´(part of word)ê²€ìƒ‰ë„ í•˜ê¸° ìœ„í•´
  - ğŸ‘ğŸ» ë‹¤ë§Œ ë” ì‘ì€ ë‹¨ìœ„ë¡œ textì˜ ì¸ë±ìŠ¤ë“¤ì„ ë§ì´ ìƒì„±í•˜ê¸°ì— ë” ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤
  - ë„ˆë¬´ ì‘ì€ ë‹¨ìœ„ë¡œ `n-gram parser`ì˜ `token`ì‚¬ì´ì¦ˆë¥¼ ì¡ìœ¼ë©´ ì„±ëŠ¥ ì €í•˜
