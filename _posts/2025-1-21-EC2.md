---
title: EC2, mysql install, S3, deploy on server
categories: [AWS, Deploy]
tags: [] # TAG names should always be lowercase
---

## âœ… EC2 ìƒì„±

- ì´ ê¸€ì´ `EC2 ìƒì„±`, `EC2ì— mySQL install`, `mySQL ì—°ê²°`ê¹Œì§€ ì„¤ëª…
- ì´ ê¸€ì„ ë”°ë¼ì„œ ì­‰ ì„¤ì¹˜
  <https://medium.com/@mudasirhaji/step-by-step-guide-on-how-to-install-mysql-8-server-on-aws-ec2linux-2-in-2024-72f3f14764b6>

- í•œêµ­ ì§€ì—­ì— EC2 ìƒì„±ì„ ìœ„í•´ ì°¸ê³ 
  <https://nowbatel.tistory.com/entry/%EC%95%84%EB%A7%88%EC%A1%B4-AWS-EC2%EC%84%9C%EB%B2%84-%EC%84%B8%ED%8C%85>

## âœ… EC2ì— mySQL install

- updateìœ„í•´ ì“°ì´ëŠ” ëª…ë ¹ì–´

```
sudo yum update -y # For CentOS/RHEL based systems

sudo systemctl restart mysqld
sudo systemctl status mysqld
```

- mySQL installìœ„í•´ ì°¸ê³ í–ˆìŒ
  <https://velog.io/@s0nnyday/AWS-EC2-%EC%97%90-MySQL-%EC%84%A4%EC%B9%98%EC%97%B0%EA%B2%B0-Amazon-Linux-2>

## ğŸ”´ libcrypto, openSSL problem

<img width="924" alt="Image" src="https://github.com/user-attachments/assets/10660aad-4e9e-4a2a-92a2-835141182638" />

- `medium.com/@mudasirhaji`ì„ ì­‰ ë”°ë¼ì„œ ì„¤ì¹˜í•˜ë‹¤ê°€ ì˜¤ë¥˜ ë°œìƒ
- `libcrypto, openSSL`ì˜¤ë¥˜ê°€ ë‚¬ë‹¤.
- ë¸”ë¡œê·¸ ê¸€ì—ì„œëŠ” `GPG Key Issues`ë¼ê³  í•˜ëŠ”ë°,
- ê²°ê³¼ë¶€í„° ë§í•˜ë©´ `GPG Key Issues`ë¬¸ì œê°€ ë§ë‹¤.
- ë¸”ë¡œê·¸ì—ì„œëŠ” `set gpgcheck=0`ë¼ê³  í•˜ëŠ”ë°, ì´ëŠ” temporarily disableí•˜ëŠ” ë°©ì‹ì´ê³  not advisableì´ë¼ê³  í•´ì„œ ê·¼ë³¸ì ì¸ í•´ê²°ë°©ë²•ì„ ì°¾ì•„ë³´ê¸°ë¡œ í•˜ì˜€ë‹¤.

- í•˜ì§€ë§Œ ì‚¬ì§„ì—ëŠ” `libcrypto, openSSL`ì˜¤ë¥˜ë¼ê³  ë– ì„œ ì•„ë‹ˆë¼ê³  ìƒê°í–ˆìŒ
- ê²°ë¡ ì ìœ¼ë¡œ, `libcrypto, openSSL`ì˜¤ë¥˜ê°€ ìœ„ ì‚¬ì§„ì²˜ëŸ¼ ëœ¨ë©´ `GPG Key Issues`ë¬¸ì œê°€ ë§ìŒ
- ê·¸ ì´ìœ ëŠ” mySQLì„ ë°›ëŠ”ë° `public key`ê°€ ì˜ëª» ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤

#### 1ï¸âƒ£ check OS

- mySQLì„ ì„¤ì¹˜í•˜ê¸° ìœ„í•´ì„œëŠ” `libcrypto, openSSL`ì´ í•„ìš”í•˜ë‹¤
- ê·¸ëŸ°ë° Amazon Linux 2023ëŠ” `compat-openssl10` ì„¤ì¹˜ê°€ ì•ˆ ëœë‹¤.

- OSë¥¼ í™•ì¸í•´ë³´ì

```bash
cat /etc/os-release
```

- ê²°ê³¼ê°€ Amazon Linux 2023ì´ë¼ë©´, `compat-openssl10` is not available
- ğŸ˜± ë‚˜ì–ì•„!!!

<img width="404" alt="Image" src="https://github.com/user-attachments/assets/251efa72-a18c-4005-b372-9083de3761b4" />

#### 2ï¸âƒ£ RPM íŒŒì¼ ë‹¤ìš´ë¡œë“œ, GPG í¼ë¸”ë¦­ í‚¤ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤

- ë”°ë¼ì„œ ì¶”ê°€ì ì¸ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤, ë‹¤ìŒê¸€ì„ ì°¸ê³ í•˜ì

- <https://velog.io/@joo_oonu/Amazon-Linux-2023-MySQL-%EC%84%A4%EC%B9%98>

#### 3ï¸âƒ£ ë§‰ìƒ mySQL ì„¤ì¹˜í•˜ë ¤ë‹ˆê¹Œ í¼ë¸”ë¦­í‚¤ë¥¼ import í•˜ëŠ” ê³¼ì •ì—ì„œ ì˜¤ë¥˜

- í¼ë¸”ë¦­í‚¤ê°€ not validí•˜ë‹¤ê³  ì˜¤ë¥˜ê°€ ëœ¬ë‹¤

<img width="895" alt="Image" src="https://github.com/user-attachments/assets/ac0822cc-c9cc-4351-b277-2667198b298e" />

#### 4ï¸âƒ£ ì˜ëª»ëœ í‚¤ë¥¼ ì§€ìš°ê³ , ë§ëŠ” í¼ë¸”ë¦­ í‚¤ ë‹¤ìš´

- remove the incorrect key
- ì—ëŸ¬ ë©”ì„¸ì§€ ë³´ë©´ `key 3a79bd29`ê°€ `not correct`í•˜ë‹¤ê³  í–ˆìŒ

```bash
sudo rpm --erase gpg-pubkey-3a79bd29
```

- import correct MySQL GPG key

```bash
sudo rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2023
```

<img width="582" alt="Image" src="https://github.com/user-attachments/assets/c950703a-1c7f-40e8-8469-02784bca28c6" />

#### 5ï¸âƒ£ ì´ì œ mySQL client, server download ê°€ëŠ¥

<img width="907" alt="Image" src="https://github.com/user-attachments/assets/35cdb275-abce-4bdd-bc75-e428fa23e5bc" />

<img width="904" alt="Image" src="https://github.com/user-attachments/assets/c28cb6b3-28b4-4124-b60f-5b4df2f8aad3" />

- ì´ì œ ì´ì–´ì„œ `medium.com/@mudasirhaji` ê¸€ `step 5` ë¶€í„° ì´ì–´ì„œ ë”°ë¼ê°€ì

## âœ… mySQL root ë¹„ë°€ë²ˆí˜¸ ì„¤ì •

- `medium.com/@mudasirhaji` ê¸€ì´ ë¶€ì‹¤í•´ì„œ
- root ì„ì‹œ ë¹„ë°€ë²ˆí˜¸, ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ë°©ë²•
- <https://velog.io/@s0nnyday/AWS-EC2-%EC%97%90-MySQL-%EC%84%A4%EC%B9%98%EC%97%B0%EA%B2%B0-Amazon-Linux-2>

<img width="575" alt="Image" src="https://github.com/user-attachments/assets/2f387ea2-12ae-48b7-9a9d-0cb0917d80c1" />

- ë¹„ë°€ë²ˆí˜¸ ì ì„ ë•Œ `'ë¹„ë°€ë²ˆí˜¸';`ì ê¸° ì£¼ì˜!
- ì´ì œ ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¡œ `mysql -u root -p`ë¥¼ í•´ì„œ mysqlì— ì ‘ì†í•˜ê²Œ ëœë‹¤

## âœ… SSH mySQL ì ‘ì† ì„±ê³µ

<img width="150" alt="Image" src="https://github.com/user-attachments/assets/486d69c0-195a-4fef-b3dc-7d8c6e60b80d" />

## âœ… Access MySQL from Outside Using MySQL Workbench

- `medium.com/@mudasirhaji` step 10

```
sudo vi /etc/my.cnf #configure íŒŒì¼ ìˆ˜ì •
bind-address = 0.0.0.0 ìˆ˜ì • ìœ„í•´ í•„ìš”
```

<img width="460" alt="Image" src="https://github.com/user-attachments/assets/dfcb2d57-9c8a-4431-acf9-c423ddb5106d" />

## âœ… mySQL ì—°ê²°

- ë¨¼ì € `user root`ì—ê²Œ ê¶Œí•œ ì£¼ì–´ì•¼ í•œë‹¤.
- `medium.com/@mudasirhaji` step 10 ì°¸ê³ 

```SQL
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'yourpassword';
CREATE USER 'root'@'%' IDENTIFIED BY 'yourpassword';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
FLUSH PRIVILEGES;
```

- ì´ë ‡ê²Œ ì…ë ¥í•˜ê³  ì—°ê²°
  <img width="679" alt="Image" src="https://github.com/user-attachments/assets/9a1c7ad5-7e39-4a1c-823c-dd41c26f7c25" />

- ì•„ë˜ ê¸€ì„ ì°¸ê³ í–ˆìœ¼ë‚˜, `Standard(TCP/IP)`ì—°ê²°ë¡œ í•´ë„ ë¬¸ì œëŠ” ì—†ë‹¤.
  <https://velog.io/@johaun12/AWS-ec2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-mysql-server%EC%97%90-%EB%A1%9C%EC%BB%AC-mysql-workbench-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0>

<img width="1068" alt="Image" src="https://github.com/user-attachments/assets/dc9a5c28-4e23-484d-8a73-a099716e8db7" />

## âœ… MYSQL í•œêµ­ì–´ ì…ë ¥ ë¶ˆê°€

- ì´ ëª…ë ¹ì–´ë¥¼ EC2ì— ë“¤ì–´ì™€ mysql commandì°½ì—ì„œ ì…ë ¥í•´ì•¼ ì‘ë™
- workbenchì—ì„œ ì…ë ¥í•´ë´¤ì ë°˜ì˜ ì•ˆë¨âŒ

```SQL
ALTER TABLE User CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Goal CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Todo CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Complete CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Comment CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Likes CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE Follow CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

SHOW CREATE TABLE comment;
```

## âœ… JAVA install

- JAVA install ëª…ë ¹ì–´
  <https://www.digitalocean.com/community/tutorials/how-to-install-java-on-centos-and-fedora>

- Java versionì´ ì—¬ëŸ¬ê°œì¸ ê²½ìš° ë‚´ í”„ë¡œì íŠ¸ì™€ ë§ì¶°ì£¼ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤
- ì„¤ì¹˜í•  ìˆ˜ ìˆëŠ” ë²„ì „ ë³´ê¸°

```
sudo yum install java
//í•˜ê³  tabì„ ë‘ ë²ˆ ëˆ„ë¥¸ë‹¤
```

<img width="587" alt="Image" src="https://github.com/user-attachments/assets/bc27a8de-4e30-4404-88df-995b70fded62" />

```
// ë‚˜ëŠ” 17ì„¤ì¹˜í•˜ê³  ì‹¶ì–´ì„œ 17 ì„¤ì¹˜
sudo yum install java-17-amazon-corretto-headless.x86_64
```

<img width="541" alt="Image" src="https://github.com/user-attachments/assets/91d931bc-b1d5-4570-82b7-5cd6e3314af1" />

## âœ… GIT install

```bash
sudo yum update -y
sudo yum install git -y
git â€”v
```

## âœ… S3

<https://kenkyuanime.com/2024%EB%85%84-%EB%B2%84%EC%A0%84aws-s3-%EC%84%B8%ED%8C%85%ED%95%98%EA%B8%B0/>

- S3 bucket CORS
  <https://note.chanyeongpark.com/posts/aws/2>

## âœ… get SSH key

<https://medium.com/@qylong2021/clone-organization-owned-private-repository-on-aws-ec2-instances-fb712dbf03ad>

<img width="825" alt="Image" src="https://github.com/user-attachments/assets/b869067d-0f34-4370-93e0-8393605a2bea" />

## âœ… add SSH key to Github

<https://gom20.tistory.com/294>

- ë‚´ github SSH keyì— ì¶”ê°€ í›„ `ssh -T git@github.com`í•˜ë ¤ê³  í–ˆì§€ë§Œ ì‹¤íŒ¨
- permission deniedë¼ê³  ë‚˜ì˜´

```bash
Trouble shooting
eval "$(ssh-agent -s)"  # Start the SSH agent
ssh-add ~/.ssh/zzikzzik_key  # Add your private key to the agent
```

- `cd ~/.ssh`

```
ssh-rsa
//key
= soheeparklee@gmail.com
```

## âœ… git action í™˜ê²½ë³€ìˆ˜ ì„¤ì •

## âœ… EC2 ìƒì„±í•  ë•Œ ë§Œë“  .pemí‚¤

- íŠ¹íˆ SSH_PRIVATE \_KEY
- pemí‚¤ëŠ” ì´ë ‡ê²Œ ìƒê²¼ìŒ
  <img width="451" alt="Image" src="https://github.com/user-attachments/assets/cf2e1c61-adb1-4e7e-9509-18807bee5721" />

## âœ… EC2 ë‚´ë¶€ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

<https://cordcat.tistory.com/118>

```bash
vi .bashrc
source .bashrc
```

## âœ… clone GIT project onto EC2

```bash
git@github.com:slid-todo/back.git
```

- EC2 ìƒì„±ë¶€í„° git cloneê¹Œì§€ ì„¤ëª…ë˜ì–´ ìˆëŠ” ê¸€ 1
  <https://velog.io/@jonghyun3668/SpringBoot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-EC2-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0>

- EC2 ìƒì„±ë¶€í„° git cloneê¹Œì§€ ì„¤ëª…ë˜ì–´ ìˆëŠ” ê¸€ 2
  <https://m.blog.naver.com/sosow0212/222841126448>

- í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì•ˆí•˜ë©´ ì‹¤íŒ¨í•¨

```bash
java -jar /home/ec2-user/back/build/libs/todo-0.0.1-SNAPSHOT.jar
# í•˜ì˜€ìœ¼ë‚˜ í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ ì•ˆ ë˜ì–´ ì‹¤íŒ¨
```

## âœ… logsë³´ëŠ” ë°©ë²•

```bash
[ec2-user@ip-172-31-12-182 ~]$ sudo chown ec2-user:ec2-user /logs
[ec2-user@ip-172-31-12-182 ~]$ chmod 755 /logs
[ec2-user@ip-172-31-12-182 ~]$ ls -ld /logs
drwxr-xr-x. 2 ec2-user ec2-user 60 Jan 18 00:01 /logs
```

## âœ… Build

```
ê¶Œí•œ ì£¼ê¸°
chmod +x gradlew

ì´ì œ gradle ì˜ ë¨
./gradlew -version

ì´ì œ ë¹Œë“œ ê°€ëŠ¥
./gradlew build
./gradlew build -x test
sudo ./gradlew build
```

## âœ… Run Java

## âœ… Run deploy.sh

```bash
chmod +x deploy.sh
./deploy.sh
```

## âœ…

## âœ…

## âœ…

## âœ…

## âœ…
